<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>框架的灵魂-反射 | 追求卓越，幸福就会不期而遇</title>
    <meta property="og:title" content="框架的灵魂-反射 - 追求卓越，幸福就会不期而遇">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-02-03T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-02-03T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="[]">
    <meta name="description" content="反射让一切有了可能">
        <meta name="author" content="默哥">
        
    <meta property="og:url" content="https://moge.fun/post/reflection/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://moge.fun">
                        追求卓越，幸福就会不期而遇
                    </a>
                
                <p class="description">汝需自取真经</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://moge.fun">首页</a>
                    
                    <a  href="https://moge.fun/archives/" title="归档">归档</a>
                    
                    <a  href="https://moge.fun/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">框架的灵魂-反射</h1>
        </header>
        <date class="post-meta meta-date">
            2020年2月3日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/Java%E5%9F%BA%E7%A1%80'>Java基础</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h2 id="什么是反射">什么是反射</h2>

<p><em>简而言之，通过反射，我们可以在运行时获得程序中每一个类型的成员和成员的信息。
程序中一般的对象的类型都是在编译期就确定下来的，而 Java 反射机制可以动态地创建对象并调用其属性，这样的对象的类型在编译期是未知的。
所以我们可以通过反射机制直接创建对象，即使这个对象的类型在编译期是未知的。</em></p>

<p><strong>反射的核心是 JVM 在运行时才动态加载类或调用方法/访问属性，它不需要事先（写代码的时候或编译期）知道运行对象是谁。</strong></p>

<h3 id="java-反射主要提供以下功能">Java 反射主要提供以下功能</h3>

<ul>
<li>在运行时构造任意一个类的对象。</li>
<li>在运行时调用任意一个对象的方法。</li>
<li>在运行时判断任意一个对象所属的类。</li>
<li>在运行时判断任意一个类所具有的成员变量和方法（通过反射甚至可以调用private方法）。</li>
</ul>

<h2 id="反射的主要用途">反射的主要用途</h2>

<p><strong>反射最重要的用途就是开发各种通用框架。</strong></p>

<p>很多框架（比如 Spring）都是配置化的（比如通过 XML 文件配置 Bean），为了保证框架的通用性，它们可能需要根据配置文件加载不同的对象或类，调用不同的方法，这个时候就必须用到反射，运行时动态加载需要加载的对象。</p>

<p>举一个例子，在运用 Struts 2 框架的开发中我们一般会在 struts.xml 里去配置 Action，比如：</p>
<pre><code>&lt;action name=&#34;login&#34; class=&#34;org.ScZyhSoft.test.action.SimpleLoginAction&#34; method=&#34;execute&#34;&gt;
    &lt;result&gt;/shop/shop-index.jsp&lt;/result&gt;
    &lt;result name=&#34;error&#34;&gt;login.jsp&lt;/result&gt;
&lt;/action&gt;</code></pre>
<p>配置文件与 Action 建立了一种映射关系，当 View 层发出请求时，请求会被 StrutsPrepareAndExecuteFilter 拦截，然后 StrutsPrepareAndExecuteFilter 会去动态地创建 Action 实例。比如我们请求 login.action，那么 StrutsPrepareAndExecuteFilter就会去解析struts.xml文件，检索action中name为login的Action，并根据class属性创建SimpleLoginAction实例，并用invoke方法来调用execute方法，这个过程离不开反射。</p>

<p>对与框架开发人员来说，反射虽小但作用非常大，它是各种容器实现的核心。而对于一般的开发者来说，不深入框架开发则用反射用的就会少一点，不过了解一下框架的底层机制有助于丰富自己的编程思想，也是很有益的。</p>

<p><strong>像Java中的一大利器注解的实现也用到了反射。</strong></p>

<p>为什么你使用 Spring 的时候 ，一个@Component注解就声明了一个类为 Spring Bean 呢？为什么你通过一个 @Value注解就读取到配置文件中的值呢？究竟是怎么起作用的呢？</p>

<p>这些都是因为你可以基于反射分析类，然后获取到类/属性/方法/方法的参数上的注解。你获取到注解之后，就可以做进一步的处理。</p>

<h2 id="反射的基本运用">反射的基本运用</h2>

<h3 id="获得class对象">获得Class对象</h3>

<p>使用Class类的forName 静态方法。</p>
<pre><code>Class appleClass = Class.forName(&#34;base.reflection.Apple&#34;);</code></pre>
<p>直接获取</p>
<pre><code>Class appleClass = Apple.class;</code></pre>
<p>获取某一个对象的class</p>
<pre><code>Apple apple = new Apple();
Class appleClass = apple.getClass();</code></pre>
<p>通过类加载器ClassLoader.loadClass()传入类路径获取</p>
<pre><code>Class appleClass = ClassLoader.getSystemClassLoader().loadClass(&#34;base.reflection.Apple&#34;);</code></pre>
<h3 id="构造方法">构造方法</h3>
<pre><code>Constructor[] declaredConstructors = appleClass.getDeclaredConstructors();
Constructor[] constructors = appleClass.getConstructors();
//通过无参构造来获取该类对象 newInstance()
Apple apple= (Apple)appleClass.newInstance();
//通过有参构造来获取该类对象 newInstance
Constructor constructor = appleClass.getConstructor(String.class,int.class,int.class);
Apple apple=(Apple)constructor.newInstance(&#34;红色&#34;,10,5);</code></pre>
<h3 id="属性">属性</h3>
<pre><code>  //getDeclaredFields所有已声明的成员变量，但不能得到其父类的成员变量
  Field[] declaredFields = appleClass.getDeclaredFields();
  //getFields访问公有的成员变量
  Field[] fields = appleClass.getFields();</code></pre>
<h3 id="方法">方法</h3>
<pre><code>//getDeclaredMethods 方法返回类或接口声明的所有方法，包括公共、保护、默认（包）访问和私有方法，但不包括继承的方法。
Method[] declaredMethods = appleClass.getDeclaredMethods();
//getMethods方法返回某个类的所有公用（public）方法，包括其继承类的公用方法。
Method[] methods = appleClass.getMethods();</code></pre>
<h3 id="调用方法">调用方法</h3>
<pre><code>Constructor constructor = appleClass.getConstructor(String.class,int.class,int.class);
Apple apple = (Apple)constructor.newInstance(&#34;红色&#34;,10,5);
//获取toString方法并调用
Method method = appleClass.getDeclaredMethod(&#34;toString&#34;);
String str = (String)method.invoke(apple);
System.out.println(str);</code></pre>
<h3 id="利用反射创建数组">利用反射创建数组</h3>
<pre><code>Class&lt;?&gt; cls = Class.forName(&#34;java.lang.String&#34;);
Object array = Array.newInstance(cls,5);
//往数组里添加内容
Array.set(array,0,&#34;hello&#34;);
Array.set(array,1,&#34;Java&#34;);
Array.set(array,2,&#34;fuck&#34;);
Array.set(array,3,&#34;Scala&#34;);
Array.set(array,4,&#34;Clojure&#34;);
//获取某一项的内容
System.out.println(Array.get(array,3));</code></pre>
        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/generic/">Java特性-泛型</a></li>
        
        <li><a href="/post/Object-oriented/">Java世界的入场券-面向对象</a></li>
        
        <li><a href="/post/studyAndThink/">学与思</a></li>
        
        <li><a href="/post/JavaOutline/">Java知识大纲</a></li>
        
        <li><a href="/post/mdGrammar/">Markdown语法</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Java%E5%9F%BA%E7%A1%80'>Java基础</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "alatan/BlogDiscuss"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://moge.fun">追求卓越，幸福就会不期而遇 By 默哥</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://moge.fun/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://moge.fun">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://moge.fun/post/SpringCloudAlibaba/" title="微服务方案SpringCloudAlibaba">微服务方案SpringCloudAlibaba</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/distributed/" title="分布式介绍">分布式介绍</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/JavaArchHistory/" title="Java架构演变历史">Java架构演变历史</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/ArrayList/" title="ArrayList详解">ArrayList详解</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/JavaContainer/" title="Java容器概览">Java容器概览</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/reflection/" title="框架的灵魂-反射">框架的灵魂-反射</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/generic/" title="Java特性-泛型">Java特性-泛型</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/Object-oriented/" title="Java世界的入场券-面向对象">Java世界的入场券-面向对象</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/studyAndThink/" title="学与思">学与思</a>
    </li>
    
    <li>
        <a href="https://moge.fun/post/JavaOutline/" title="Java知识大纲">Java知识大纲</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://moge.fun/categories/Java%E5%9F%BA%E7%A1%80/">Java基础 (5)</a></li>
    
    <li><a href="https://moge.fun/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式 (1)</a></li>
    
    <li><a href="https://moge.fun/categories/%E5%8F%8D%E6%80%9D/">反思 (1)</a></li>
    
    <li><a href="https://moge.fun/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务 (2)</a></li>
    
    <li><a href="https://moge.fun/categories/%E7%90%86%E8%B4%A2/">理财 (1)</a></li>
    
    <li><a href="https://moge.fun/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系 (1)</a></li>
    
    <li><a href="https://moge.fun/categories/%E8%AE%B0%E5%BD%95/">记录 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://moge.fun/tags/Java%E5%9F%BA%E7%A1%80/">Java基础</a>
    
    <a href="https://moge.fun/tags/Markdown/">Markdown</a>
    
    <a href="https://moge.fun/tags/SpringCloud/">SpringCloud</a>
    
    <a href="https://moge.fun/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
    
    <a href="https://moge.fun/tags/%E5%8F%8D%E6%80%9D/">反思</a>
    
    <a href="https://moge.fun/tags/%E5%A4%A7%E7%BA%B2/">大纲</a>
    
    <a href="https://moge.fun/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a>
    
    <a href="https://moge.fun/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>
    
    <a href="https://moge.fun/tags/%E7%90%86%E8%B4%A2/">理财</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://moge.fun/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>